import{H as R,G as q,r as I,j as e,F as Y,c as o,I as S,bf as Z,ba as Q,ax as T,W as ee,bg as E,bh as W,T as D,J,Q as j,a as ae,bi as te,C as se}from"./index.c3bfd613.js";import{r as P}from"./index.8a249f4e.js";import{d as re}from"./dayjs.min.68b8090d.js";import{d as le,a as ie,e as oe,f as de}from"./imageApiSlice.1ba03d6d.js";import{R as ce,A as ne}from"./AddCard.65c4e3a3.js";import{u as pe,b as ue}from"./index.esm.a72616c3.js";import{c as me,a as G,o as ge}from"./object.a233b247.js";import"./upperFirst.93ed485a.js";const he=({cardsData:u})=>{const x=R(),b=q(),v=[{name:"view",icon:"heroicons-outline:eye",doit:a=>x(`/card/${a.id}`)},{name:"edit",icon:"heroicons:pencil-square",doit:a=>b(Z(a))}],m=[{Header:"name",accessor:"name",Cell:a=>{var t,d,n,_,i;return console.log("row",a),o("span",{className:"flex items-center min-w-[150px]",children:[e("span",{className:"w-8 h-8 rounded-full ltr:mr-3 rtl:ml-3 flex-none",children:e("img",{src:(n=a==null?void 0:a.data[(d=(t=a==null?void 0:a.cell)==null?void 0:t.row)==null?void 0:d.index])==null?void 0:n.icon_url,alt:(_=a==null?void 0:a.cell)==null?void 0:_.value,className:"object-cover w-full h-full rounded-full"})}),e("span",{className:"text-sm text-slate-600 dark:text-slate-300 capitalize",children:(i=a==null?void 0:a.cell)==null?void 0:i.value})]})}},{Header:"status",accessor:"is_active",Cell:a=>{var t,d;return e("span",{className:"block min-w-[140px] text-left",children:o("span",{className:"inline-block text-center mx-auto py-1",children:[((t=a==null?void 0:a.cell)==null?void 0:t.value)===!1&&o("span",{className:"flex items-center space-x-3 rtl:space-x-reverse",children:[e("span",{className:"h-[6px] w-[6px] bg-danger-500 rounded-full inline-block ring-4 ring-opacity-30 ring-danger-500"}),e("span",{children:"Inactive"})]}),((d=a==null?void 0:a.cell)==null?void 0:d.value)===!0&&o("span",{className:"flex items-center space-x-3 rtl:space-x-reverse",children:[e("span",{className:"h-[6px] w-[6px] bg-success-500 rounded-full inline-block ring-4 ring-opacity-30 ring-success-500"}),e("span",{children:"Active"})]})]})})}},{Header:"Updated AT",accessor:"updated_at",Cell:a=>{var t;return e("span",{children:re((t=a==null?void 0:a.cell)==null?void 0:t.value).format("DD/MM/YYYY HH:mm:ss")})}},{Header:"action",accessor:"action",Cell:a=>e("div",{className:" text-center",children:e("div",{className:"grid grid-cols-[100px_100px_100px] gap-2 divide-x divide-slate-100 dark:divide-slate-800",children:v.map((t,d)=>e("div",{onClick:()=>{var n;return t.doit((n=a==null?void 0:a.row)==null?void 0:n.original)},children:o("div",{className:`
                
                  ${t.name==="delete"?"bg-danger-500 text-danger-500 bg-opacity-30   hover:bg-opacity-100 hover:text-white":"hover:bg-slate-900 hover:text-white dark:hover:bg-slate-600 dark:hover:bg-opacity-50"}
                   w-full border border-gray-500 border-opacity-10 px-4 py-2 text-sm  last:mb-0 cursor-pointer 
                   first:rounded-t last:rounded-b flex  space-x-2 items-center rtl:space-x-reverse `,children:[e("span",{className:"text-base",children:e(S,{icon:t.icon})}),e("span",{children:t.name})]})},d))})})}],f=I.exports.useMemo(()=>m,[]),l=I.exports.useMemo(()=>u,[]),N=P.exports.useTable({columns:f,data:l,initialState:{pageSize:l==null?void 0:l.length}},P.exports.useGlobalFilter,P.exports.useSortBy,P.exports.usePagination,P.exports.useRowSelect),{getTableProps:C,getTableBodyProps:y,headerGroups:s,footerGroups:F,page:k,nextPage:M,previousPage:U,canNextPage:w,canPreviousPage:c,pageOptions:B,state:H,gotoPage:g,pageCount:L,setPageSize:V,setGlobalFilter:$,prepareRow:A}=N;return e(Y,{children:e("div",{children:e("div",{className:"overflow-x-auto -mx-6",children:e("div",{className:"inline-block min-w-full align-middle",children:e("div",{className:"overflow-hidden ",children:o("table",{className:"min-w-full divide-y divide-slate-100 table-fixed dark:divide-slate-700",...C,children:[e("thead",{className:" bg-slate-100 dark:bg-slate-700",children:s==null?void 0:s.map(a=>e("tr",{...a.getHeaderGroupProps(),children:a.headers.map(t=>o("th",{...t.getHeaderProps(t.getSortByToggleProps()),scope:"col",className:" table-th ",children:[t.render("Header"),e("span",{children:t.isSorted?t.isSortedDesc?" \u{1F53D}":" \u{1F53C}":""})]}))}))}),e("tbody",{className:"bg-white divide-y divide-slate-100 dark:bg-slate-800 dark:divide-slate-700",...y,children:k==null?void 0:k.map(a=>(A(a),e("tr",{...a.getRowProps(),children:a.cells.map(t=>e("td",{...t.getCellProps(),className:"table-td py-2",children:t.render("Cell")}))})))})]})})})})})})},be=()=>{var d,n,_;const{id:u}=Q();console.log("category id inside addCard",u);const{editCardModal:x,editCardItem:b}=T(i=>i.card),{token:v}=T(i=>i.auth);console.log("token inside modal add card",v);const m=q(),[f,l]=I.exports.useState("initial"),[N]=le(),[C,{isLoading:y}]=ie(),{data:s,isFetching:F}=oe(b.id,{skipPollingIfUnfocused:!0,refetchOnMountOrArgChange:!0,skip:!1}),k=me({name:G().required("Category name is required"),icon_url:G().required("Category image is required")}).required(),{register:M,control:U,reset:w,formState:{errors:c},handleSubmit:B,getValues:H,setValue:g}=pe({defaultValues:s,resolver:ge(k),mode:"all"});console.log("editCardItem",b),console.log("getCardById edit card",s),I.exports.useEffect(()=>{s&&(g("name",s.name),g("levels",s.levels),g("icon_url",s.icon_url),g("is_active",s.is_active),g("requirements",s.requirements),l("uploaded"))},[s]);const{fields:L,append:V,remove:$,swap:A}=ue({control:U,name:"levels"});console.log("errors",c);const a=async i=>{var r;try{console.log("data",i);const{name:h,icon_url:K,levels:X}=i,O={id:s.id,name:h,icon_url:K,category_id:parseInt(u),levels:X.map(z=>({profit_per_hour:parseInt(z.profit_per_hour),upgrade_price:parseInt(z.upgrade_price)}))},p=await N(O);if(console.log("response create card",p),console.log("edit card",O),p!=null&&p.data)m(E(!1)),j.success("Add Card Successful"),l("initial");else if((r=p==null?void 0:p.error)!=null&&r.data)throw new Error(p.error.data.message);w()}catch(h){m(E(!1)),j.error(h.message),l("initial")}},t=async i=>{console.log("file event",i.target.files[0]),l("uploading");try{const r=new FormData;r.append("image",i.target.files[0]);const h=await C(r);if(console.log("image upload success",h.data),!h.data.status)throw new Error("Failed to upload image");g("icon_url",h.data.data,{shouldValidate:!0}),l("success")}catch(r){console.error(r),l("fail")}};return e("div",{children:e(ee,{title:"Edit Card",labelclassName:"btn-outline-dark",activeModal:x,onClose:()=>{console.log("modal closed"),m(E(!1))},children:F?e(W,{}):o("form",{onSubmit:B(a),className:"space-y-4 ",children:[e(D,{name:"name",label:"Card Name",placeholder:"Card Name",register:M,error:c.name}),e("label",{htmlFor:"card-icon",className:"block capitalize flex-0 mr-6 md:w-[100px] w-[60px] break-words ",children:"Image"}),f==="uploaded"&&H().icon_url?o("div",{className:"relative w-28 border border-neutral-200 rounded-md p-4",children:[e("img",{src:(d=H())==null?void 0:d.icon_url,alt:(n=H())==null?void 0:n.name,className:"object-cover w-16 h-16 rounded-full"}),e("button",{className:"absolute top-1 right-1",type:"button",onClick:()=>l("initial"),children:e(S,{className:"text-red-600",icon:"heroicons-outline:trash"})})]}):o(Y,{children:[e("input",{type:"file",onChange:t}),e(ce,{status:f})]}),o("div",{className:"w-full",children:[(c==null?void 0:c.icon_url)&&e("div",{className:" mt-2 text-danger-500 block text-sm ",children:(_=c==null?void 0:c.icon_url)==null?void 0:_.message}),L.map((i,r)=>o("div",{className:"flex items-center gap-4 border rounded-sm px-2 py-4",children:[o("label",{htmlFor:`Level-${r}`,className:"mt-8 block capitalize flex-0 mr-6 md:w-[100px] w-[60px] break-words font-semibold text-slate-800 ",children:["Level ",r]}),e(D,{name:`levels.${r}.upgrade_price`,label:"Upgraded Price",placeholder:"Upgraded Price",register:M,defaultValue:i.upgrade_price}),e(D,{name:`levels.${r}.profit_per_hour`,label:"Profit per Hour",placeholder:"Profit per Hour",register:M,defaultValue:i.profit_per_hour}),e("button",{className:"mt-6 border rounded-lg p-2 border-red-600",type:"button",onClick:()=>A(r,r+1),children:e(S,{className:"text-red-600",icon:"heroicons-outline:arrow-down"})}),e("button",{className:"mt-6 border rounded-lg p-2 border-green-600",type:"button",onClick:()=>A(r,r-1),children:e(S,{className:"text-green-600",icon:"heroicons-outline:arrow-up"})}),e("button",{className:"mt-6",type:"button",onClick:()=>$(r),children:e(S,{className:"text-red-600",icon:"heroicons-outline:trash"})})]},i.id)),e("button",{className:"flex w-full justify-center bg-slate-600 font-semibold text-white my-4 py-2 rounded-md",type:"button",onClick:()=>V({upgraded_price:0,profit_per_hour:0}),children:"Add New Level"})]}),e("div",{className:"ltr:text-right rtl:text-left",children:e(J,{type:"submit",text:"Edit Card",className:"btn btn-dark block w-full text-center ",isLoading:y})})]})})})},Pe=()=>{const{id:u}=Q(),x=R(),b=q(),{width:v,breakpoints:m}=ae(),{editCardModal:f}=T(F=>F.card);console.log("categories id",u);const{data:l,isLoading:N,isFetching:C,isError:y,error:s}=de(u,{skipPollingIfUnfocused:!0,refetchOnMountOrArgChange:!0,skip:!1});return console.log("getCards",l,s),I.exports.useEffect(()=>{y&&(s==null?void 0:s.status)===401&&(j.error("Session expired, please relogin"),localStorage.removeItem("token"),x("/"))},[s]),o("div",{className:" space-y-5",children:[e("div",{className:"grid grid-cols-12 gap-5"}),N||C?e(W,{}):e("div",{className:"grid grid-cols-12 gap-5",children:o("div",{className:"xl:col-span-12 lg:col-span-12 col-span-12",children:[e("div",{className:`${v<m.md?"space-x-rb":""} md:flex md:space-x-4 md:justify-end items-center rtl:space-x-reverse my-4`,children:e(J,{icon:"heroicons-outline:plus",text:"Add Card",className:"btn-dark dark:bg-slate-800  h-min text-sm font-normal",iconClass:" text-lg",onClick:()=>b(te(!0))})}),l&&e(se,{title:"Cards",noborder:!0,children:e(he,{cardsData:l})})]})}),e(ne,{}),f&&e(be,{})]})};export{Pe as default};
