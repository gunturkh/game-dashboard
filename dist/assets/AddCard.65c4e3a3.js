import{j as e,ba as z,ax as _,G as E,r as H,W as R,bi as u,c,T as p,I as m,J as T,Q as w}from"./index.c3bfd613.js";import{u as B,b as G}from"./index.esm.a72616c3.js";import{c as J,a as C,o as Q}from"./object.a233b247.js";import{g as W,a as K}from"./imageApiSlice.1ba03d6d.js";const O=({status:s})=>s==="success"?e("p",{children:"\u2705 Uploaded successfully!"}):s==="fail"?e("p",{children:"\u274C Upload failed!"}):s==="uploading"?e("p",{children:"\u23F3 Uploading started..."}):null,ae=()=>{var f;const{id:s}=z();console.log("category id inside addCard",s);const{openCardModal:y}=_(r=>r.card),{token:N}=_(r=>r.auth);console.log("token inside modal add card",N);const n=E(),[x,d]=H.exports.useState("initial"),[v]=W(),[k,{isLoading:F}]=K(),S=J({name:C().required("Category name is required"),icon_url:C().required("Category image is required")}).required(),{register:i,control:A,reset:U,formState:{errors:t},handleSubmit:I,setValue:M}=B({defaultValues:{levels:[{upgraded_price:0,profit_per_hour:0}]},resolver:Q(S),mode:"all"}),{fields:V,append:q,remove:P,swap:g}=G({control:A,name:"levels"});console.log("errors",t);const j=async r=>{var a;try{console.log("data",r);const{name:l,icon_url:$,levels:D}=r,h={name:l,icon_url:$,category_id:parseInt(s),levels:D.map(b=>({profit_per_hour:parseInt(b.profit_per_hour),upgrade_price:parseInt(b.upgraded_price)}))},o=await v(h);if(console.log("response create card",o),console.log("create card",h),o!=null&&o.data)n(u(!1)),w.success("Add Card Successful"),d("initial");else if((a=o==null?void 0:o.error)!=null&&a.data)throw new Error(o.error.data.message);U()}catch(l){n(u(!1)),w.error(l.message),d("initial")}},L=async r=>{console.log("file event",r.target.files[0]),d("uploading");try{const a=new FormData;a.append("image",r.target.files[0]);const l=await k(a);if(console.log("image upload success",l.data),!l.data.status)throw new Error("Failed to upload image");M("icon_url",l.data.data,{shouldValidate:!0}),d("success")}catch(a){console.error(a),d("fail")}};return e("div",{children:e(R,{title:"Create Card",labelclassName:"btn-outline-dark",activeModal:y,onClose:()=>n(u(!1)),children:c("form",{onSubmit:I(j),className:"space-y-4 ",children:[e(p,{name:"name",label:"Card Name",placeholder:"Card Name",register:i,error:t.name}),e("label",{htmlFor:"card-icon",className:"block capitalize flex-0 mr-6 md:w-[100px] w-[60px] break-words ",children:"Image"}),e("input",{type:"file",onChange:L}),e(O,{status:x}),c("div",{className:"w-full",children:[(t==null?void 0:t.icon_url)&&e("div",{className:" mt-2 text-danger-500 block text-sm ",children:(f=t==null?void 0:t.icon_url)==null?void 0:f.message}),V.map((r,a)=>c("div",{className:"flex items-center gap-4 border rounded-sm px-2 py-4",children:[c("label",{htmlFor:`Level-${a}`,className:"mt-8 block capitalize flex-0 mr-6 md:w-[100px] w-[60px] break-words font-semibold text-slate-800 ",children:["Level ",a]}),e(p,{name:`levels.${a}.upgraded_price`,label:"Upgraded Price",placeholder:"Upgraded Price",register:i,defaultValue:r.upgraded_price}),e(p,{name:`levels.${a}.profit_per_hour`,label:"Profit per Hour",placeholder:"Profit per Hour",register:i,defaultValue:r.profit_per_hour}),e("button",{className:"mt-6 border rounded-lg p-2 border-red-600",type:"button",onClick:()=>g(a,a+1),children:e(m,{className:"text-red-600",icon:"heroicons-outline:arrow-down"})}),e("button",{className:"mt-6 border rounded-lg p-2 border-green-600",type:"button",onClick:()=>g(a,a-1),children:e(m,{className:"text-green-600",icon:"heroicons-outline:arrow-up"})}),e("button",{className:"mt-6",type:"button",onClick:()=>P(a),children:e(m,{className:"text-red-600",icon:"heroicons-outline:trash"})})]},r.id)),e("button",{className:"flex w-full justify-center bg-slate-600 font-semibold text-white my-4 py-2 rounded-md",type:"button",onClick:()=>q({upgraded_price:0,profit_per_hour:0}),children:"Add New Level"})]}),e("div",{className:"ltr:text-right rtl:text-left",children:e(T,{type:"submit",text:"Add Card",className:"btn btn-dark block w-full text-center ",isLoading:F})})]})})})};export{ae as A,O as R};
