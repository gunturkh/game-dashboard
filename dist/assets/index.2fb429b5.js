import{b as _,ax as D,G as F,r as x,j as e,W as E,bj as L,bh as M,c as u,T as H,I as y,J as T,Q as k,H as A,F as z,a as R,aL as V,C as q}from"./index.c3bfd613.js";import{c as B,o as G}from"./object.a233b247.js";import"./imageApiSlice.1ba03d6d.js";import{u as U,b as $}from"./index.esm.a72616c3.js";import{r as f}from"./index.8a249f4e.js";import"./dayjs.min.68b8090d.js";import"./upperFirst.93ed485a.js";const Q=_.injectEndpoints({tagTypes:["Levels"],endpoints:i=>({getLevels:i.query({query:s=>({url:"/admin/levels",params:s&&{id:s}}),transformResponse:s=>s.data,providesTags:["Levels"]}),createLevel:i.mutation({query:s=>({url:"/admin/levels",method:"POST",body:s}),transformResponse:s=>s.data,invalidatesTags:["Levels"]})})}),{useGetLevelsQuery:j,useCreateLevelMutation:W}=Q,J=()=>{const{openCardModal:i}=D(a=>a.level),{data:s,isFetching:p}=j({skipPollingIfUnfocused:!0,refetchOnMountOrArgChange:!0,skip:!1}),n=F(),[d]=W(),v=B({}).required(),{register:g,control:r,reset:m,formState:{errors:h},handleSubmit:S,setValue:C,getValues:I}=U({defaultValues:s,resolver:G(v),mode:"all"});console.log("errors",h),x.exports.useEffect(()=>{console.log("getLevels addLevel",s),s&&C("levels",s)},[s]);const{fields:c,append:P,remove:w,swap:N}=$({control:r,name:"levels"});return x.exports.useEffect(()=>{console.log("fields",c)},[c]),e("div",{children:e(E,{title:"Add New Level",labelclassName:"btn-outline-dark",activeModal:i,onClose:()=>n(L(!1)),children:p?e(M,{}):u("form",{onSubmit:S(async a=>{var o;try{console.log("data",a);const b=(o=a==null?void 0:a.levels)==null?void 0:o.map(t=>({level:t.level,minimum_score:parseInt(t.minimum_score)})),l=await d({levels:b});console.log("response create level",l.data),k.success("Add Level Successful"),n(L(!1)),m()}catch(b){k.error(b.message)}}),className:"space-y-4 ",children:[c.map((a,o)=>u("div",{className:"flex items-center gap-4 border rounded-sm px-2 py-4",children:[u("label",{htmlFor:`Level-${o}`,className:"mt-8 block capitalize flex-0 mr-6 md:w-[100px] w-[60px] break-words font-semibold text-slate-800 ",children:["Level ",a==null?void 0:a.level]}),e(H,{name:`levels.${o}.minimum_score`,label:"Minimum Score",placeholder:"Minimum Score",register:g,defaultValue:a.minimum_score}),e("button",{className:"mt-6 border rounded-lg p-2 border-red-600",type:"button",onClick:()=>N(o,o+1),children:e(y,{className:"text-red-600",icon:"heroicons-outline:arrow-down"})}),e("button",{className:"mt-6 border rounded-lg p-2 border-green-600",type:"button",onClick:()=>N(o,o-1),children:e(y,{className:"text-green-600",icon:"heroicons-outline:arrow-up"})}),e("button",{className:"mt-6",type:"button",onClick:()=>w(o),children:e(y,{className:"text-red-600",icon:"heroicons-outline:trash"})})]},a.id)),e("button",{className:"flex w-full justify-center bg-slate-600 font-semibold text-white my-4 py-2 rounded-md",type:"button",onClick:()=>P({level:c.length+1,minimum_score:c[c.length-1].minimum_score+5}),children:"Add New Level"}),e("div",{className:"ltr:text-right rtl:text-left",children:e(T,{type:"submit",text:"Submit Level",className:"btn btn-dark block w-full text-center "})})]})})})},K=({levelsData:i})=>{A();const s=[{Header:"level",accessor:"level",Cell:l=>{var t;return e("span",{className:"flex items-center min-w-[150px]",children:e("span",{className:"text-sm text-slate-600 dark:text-slate-300 capitalize",children:(t=l==null?void 0:l.cell)==null?void 0:t.value})})}},{Header:"minimum score",accessor:"minimum_score",Cell:l=>{var t;return e("span",{className:"flex items-center min-w-[150px]",children:e("span",{className:"text-sm text-slate-600 dark:text-slate-300 capitalize",children:(t=l==null?void 0:l.cell)==null?void 0:t.value})})}}],p=x.exports.useMemo(()=>s,[]),n=x.exports.useMemo(()=>i,[]),d=f.exports.useTable({columns:p,data:n,initialState:{pageSize:n==null?void 0:n.length}},f.exports.useGlobalFilter,f.exports.useSortBy,f.exports.usePagination,f.exports.useRowSelect),{getTableProps:v,getTableBodyProps:g,headerGroups:r,footerGroups:m,page:h,nextPage:S,previousPage:C,canNextPage:I,canPreviousPage:c,pageOptions:P,state:w,gotoPage:N,pageCount:O,setPageSize:a,setGlobalFilter:o,prepareRow:b}=d;return e(z,{children:e("div",{className:"p-2",children:e("div",{className:"overflow-x-auto -mx-6",children:e("div",{className:"inline-block min-w-full align-middle",children:e("div",{className:"overflow-hidden ",children:u("table",{className:"min-w-full divide-y divide-slate-100 table-fixed dark:divide-slate-700",...v,children:[e("thead",{className:" bg-slate-100 dark:bg-slate-700",children:r==null?void 0:r.map(l=>e("tr",{...l.getHeaderGroupProps(),children:l.headers.map(t=>u("th",{...t.getHeaderProps(t.getSortByToggleProps()),scope:"col",className:" table-th ",children:[t.render("Header"),e("span",{children:t.isSorted?t.isSortedDesc?" \u{1F53D}":" \u{1F53C}":""})]}))}))}),e("tbody",{className:"bg-white divide-y divide-slate-100 dark:bg-slate-800 dark:divide-slate-700",...g,children:h==null?void 0:h.map(l=>(b(l),e("tr",{...l.getRowProps(),children:l.cells.map(t=>e("td",{...t.getCellProps(),className:"table-td py-2",children:t.render("Cell")}))})))})]})})})})})})};function ae(){const i=A(),s=F(),{width:p,breakpoints:n}=R(),{data:d,isLoading:v,isFetching:g,error:r,isError:m}=j(void 0,{skipPollingIfUnfocused:!0,refetchOnMountOrArgChange:!0,skip:!1});return x.exports.useEffect(()=>{console.log("error",r),console.log("isError",m),m&&(r==null?void 0:r.status)===401&&(k.error("Session expired, please relogin"),localStorage.removeItem("token"),i("/"))},[r,m]),console.log("getLevels",d),v||g?e(M,{}):u("div",{children:[e(V,{}),e("div",{className:"flex flex-wrap justify-between items-center mb-4"}),e("div",{className:`${p<n.md?"space-x-rb":""} mb-4 md:flex md:space-x-4 md:justify-end items-center rtl:space-x-reverse`,children:e(T,{icon:"heroicons-outline:plus",text:"Add Level",className:"btn-dark dark:bg-slate-800  h-min text-sm font-normal",iconClass:" text-lg",onClick:()=>s(L(!0))})}),e(q,{title:"Level",noborder:!0,children:e(K,{levelsData:d})}),e(J,{})]})}export{ae as default};
